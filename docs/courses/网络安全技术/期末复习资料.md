# 网络安全技术期末复习文档

## 第一章复习

### 针对IP协议的攻击

1. 分片IP报文攻击

在传输大的IP报文的时候会对报文进行分片，计算机在接受这些分片的报文的时候会先把这些报文存储在内存中，如果攻击者发送大量的分片报文，就会导致目标计算机的资源耗尽。

2. 死亡之Ping

TCP/IP协议对于IP报文的长度有一定的要求，如果发送长度大于64的报文可能导致目标计算机IP协议栈溃。

2. 泪滴攻击

IP协议在分片的时候会设置好偏移字段，如果攻击者给你一个不正常的偏置字段就有可能导致目标操作系统的崩溃

3. IP欺骗

一般情况下，路由器在转发报文的时候之后根据检查目的地址不会检查报文的源地址，攻击者就可以伪装源地址，这样的报文在到达目标计算机便可能向一个毫无知觉的第三方计算机回应。


### TCP三次握手

#### TCP三次握手的过程

第一次握手：客户端主动打开连接，发送SYN=1，ACK=0的TCP报文到服务器，初始序号为x，同时客户端进入SYN_SEND状态。

第二次握手：服务器收到SYN包，发送确认SYN（ack=x+1），自己还发送一个SYN（seq=y）同时服务器进入SYN_RECV状态。

第三次握手：客户端收到服务器的SYN+ACK，回复ACK=1，ack=y+1，在数据段写seq+1. 客户端和服务器都进入到ESTABLISHED状态。

#### TCP协议哪些字段可用于攻击

1. SYN攻击

如果攻击者监听到了B发送的SYN ACK包，那么攻击者就可以像B发送RST包，接着发送SYN包冒充A建立起新的连接。B就会响应新的连接，并发送响应报名SYN/ACK, 攻击者再ACK包就可以达到破坏连接的作用，还可以进一步去插入有害的数据包。

2. SYN洪水攻击

攻击者不停的像目标主机发送SYN包，目标主机每次都会开辟内存去存储TCP连接需要的信息，最终目标主机的资源会被耗尽。

### 计算数据分片

假设一数据报的总长度为3820字节，其数据部分为3800字节长（使用固定首部），需要分片为长度不超过1420字节的数据报片。试给出分片后每个数据报片相关的字段的值（包括MF，DF，片偏移）

MF表示后续是否还有分片，为1表示还有分片，0表示没有分片了，DF全写0就好。=-=
### 半连接队列和全连接队列

1、它们有什么作用？
半连接队列用来保存SYN_SENT和SYN_RECV状态的请求
全连接队列用来保存处于established状态的请求
半连接存活时间：用半连接队列的条目存活的最长时间，半连接存错时间可以在网络波动的时候给客户端重新发送请求的机会

片偏移需要看数据部分的长度，比如这题说数据部分长3800，那就说明头部长 3820 - 3800 = 20， 长度为1420的数据包有1400的部分是数据，每次的偏移就是 1400 * 数据包号 / 8

## 第二章

### 攻击一个站点的流程

在只知道站点域名的情况下如何一步一步查明站点所用的IP地址、管理员的联系方式已经内部主机的资料？

1. IP地址可以通过ping命令获取
2. 管理员联系方式可以用过whois获取
3. 对于内部的资产，端口可以通过nmap，目录可以通过dirsearch，资产可以通过fofa进行收集

### 查询主机满足一定条件的主机

使用fofa进行搜索，下面是fofa的一些语法规则：

搜索国家：country="xxx"
搜索城市：city="xxx"
搜索操作系统：os="xxx"
搜索某个时间之后：after="xxxx-xx-xx"
搜索某个时间之前：before="xxxx-xx-xx"
不同条件之间用 && 隔开

使用Shodan进行查询：
搜索国家：Country:"xxx"
搜索城市：City:"xxx"
搜索操作系统：Os:"xxx"
搜索某个时间之后：After:"日/月/年"
搜索某个时间之前：Before:"日/月/年"
不同条件之间用空格隔开

### 百度搜索语法

搜索文件类型：filetype:xxx
搜索标题里面：intitle:xxx
搜索域名：site:xxx
搜索网址里面包含xxx：inurl:xxx

## 第三讲

### WannaCry端口扫描的机制

Wannacry首先会尝试连接445端口，测试是否存在SMB漏洞，如果存在漏洞会利用漏洞进行进一步攻击

预防措施：
关闭漏洞端口，安装系统补丁
备份数据，安装安全软件，开启防护

### 漏洞扫描蕴含的技术

1. 主机发现：ARP扫描、ICMP扫描
2. 端口扫描：TCP扫描，FTP代理扫描，UDP扫描
3. OS识别：
4. 漏洞扫描：

### 漏洞扫描工具

至少要知道一个，比如AWVS
AWVS首先会扫描整个网络，在扫描的过程之后AWVS会自动的对每个页面通过自定义脚步去发动一系列攻击，在发现了漏洞后会自动生成报告，报告中包含漏洞信息以及漏洞如何修补的建议。

## 拒绝服务攻击

### TCP SYN洪流

1、攻击原理是怎么样的

在三次握手中，服务器在发送了syn+ack报文后，若没有在一段时间之后没有回应会进行重转，当重传的次数超过阈值后服务器才会销毁TCP连接。如果攻击者不断的发送SYN报文，而不回复服务器的syn+ack报文就会导致服务器的资源被耗尽；

2、半连接表的变化情况

半连接表中有大量的SEND_RECV状态的报文，占满整个半连接表

3、 为什么要使用伪造的源地址

隐藏来源，防止响应，影响被伪造的地址，增加检测范围

4、SYN洪流和LAND攻击的区别

伪造的源地址不同，LAND是把目的地址和源地址都设置成目标服务器的网址，SYN是伪造的源地址

5、可以采取的防御措施

1. 缩短SYN timeout时间
2. 加固tcp/ip协议栈

6、TCP SYN扫描的原理和TCP connect（）扫描相比有什么有点，需要有什么前提？
原理：扫描器向着目标主机发送SYN包，如果回答是RST包则说明端口关闭如果是syn+ack报则说明目前端口处于监听状态
优点：SYN扫描要更加隐蔽，TCP connect扫描因为建立了完整的连接会留下扫描记录
前提：需要管理员权限



### 反射式DDos攻击

1、分析反射式DDos攻击的基本原理

攻击者并不直接攻击目标服务IP，而是通过伪装被攻击者的IP向开放某些特殊服务器的服务器发送请求报文，该服务器会将数倍于请求报文的回复数据发送目标IP

2、反射式DDos攻击的优势

反射式DDos攻击非常难以追踪，且不需要大量的肉鸡

3、设计一个基于SSDP协议的反射式DDos攻击方案

SSDP的平均数据包放大效果为7倍，带宽放大效果约为20倍。假设需要生成100Gbps的攻击流量，按照SSDP反射型ddos攻击平均7倍的包放大效果和20倍的带宽方法效果、每个反射器平均发送7个数据包，响应数据包平均具有321字节，那么需要伪造100Gbps/20=5Gbps的伪造报文带宽，反射器平均每秒向受害者发送100Gbps/321Byte/8=38.94Mpps。假设一共有920k反射器，平均每个反射器每秒向受害者发送4232.6pps，按照7倍的放大效果，攻击者每秒需要发送4232.6/7大约605个数据包到920k个反射器即可达到100Gbps的ddos效果。

## 木马技术

### 远控木马

1、 使用远程控制木马有何优点

1. 解决了内网IP地址和动态IP地址带来的连接问题
2. 可以绕过防火墙的想着
3. 可以第一时间获取被控端上线的信息
4. 可以控制局域网内的其他主机

2、 木马反向连接的原理

反弹连接木马，就是在我们机器上开启一个端口，让中马者来连接我们，从而获得肉鸡的信息

3、 这种木马的检测方法

分析主机建立的网络，根据用户本系统的具体情况，对网络连接进行辨别和区分，及时发现异常。此外还可以对博客网站的访问量进行统计，如果访问量极少，那么该博客可能有问题。

### 利用远程控制性木马入侵

1、入侵步骤

配置木马  ->  传播木马  -> 运行木马 -> 信息反馈 -> 建立连接 -> 远程控制

2、ICMP协议的可攻击点
木马利用ICMP隐秘通信的特点，ICMP木马监听报文，当出现特殊报文的时候打开TCP端口等待控制端连接，不激活的时候没有端口开放；

### 检测木马

1、对 C:Windows\System32 目录下的EXE和DLL文件作记录，并周期性地进行比较
对文件做备份并计算哈希值，周期性检验哈希值是否相同

## 口令安全性分析

1、 分析身份证、生日和手机号码等口令的安全性

手机号有11位，有10^11种可能，生日可以根据社会工程学进行进一步的缩小。
身份证有18位，但是每一位数字都有具体的含义，如果通过社会工程学知道攻击对象的更多信息就可以缩小爆破的范围

2、举例弱口令

123456、PASSWORD、ABC123、12345、666666  ...

3、动态口令的使用场景

steam游戏令牌

4、动态口令的挑战-响应原理
用户通过网络传给服务器的口令是种子值、迭代值和通行短语在计算器作用下的计算结果，用户本身的通行短语并没有在网上传播。
只要计算器足够复杂，就很难从中提取出原始的通行短语，从而有效地抵御了网络监听 攻击。又因为迭代值总是不断变化的，比如每当身份认证成功时，将用户的迭代值自动减1，这使得下一次用户登录时使用鉴别信息与上次不同， 从而有效地阻止了重放攻击。

## 网络监听技术

### MAC 洪泛攻击

1、交换机MAC表的自学习过程

交换机会将学习到的MAC地址存储在MAC地址表里面，但是MAC地址表的大小邮箱，并且MAC地址表上的地址有老化时间

2、MAC洪泛攻击的过程

MAC洪泛会不断的虚拟MAC地址来填满MAC地址表，让其无法学习正确的MAC地址，这个时候如果需要转发一个数据帧，因为MAC地址表里面没有目的地址的MAC地址，交换机就会广播数据帧到所有接口。利用这个机制就可以获取数据帧的信息。

3、针对MAC洪泛攻击的防御措施

1. 限定交换机的接入端口数量，当一个端口学习的MAC数量超过了防御的数量，那么超出的MAC地址会被舍弃掉
2. 规定端口能够通过什么样的MAC地址和学习什么样的MAC地址

4、为什么MAC洪泛攻击会使得交换机以集线器的模式工作？

因为当MAC洪泛攻击会使得交互机的MAC表里面全是错误的MAC地址，交互及找不到目标地址的MAC地址时就会广播数据集，这时候交换机的工作方式就近似于集线器。

### ARP欺骗

1、ARP欺骗的步骤
ARP欺骗分为对用户进行ARP欺骗和对路由器进行ARP欺骗
对用户进行ARP欺骗：攻击者首先构造出ARP应答数据包，然后发送给欺骗着，用假的IP地址与MAC地址的映射来更新ARP高数缓存，实现对欺骗者的ARP欺骗

2、攻击过程中ARP高速缓存的变化情况
被攻击者在接收到伪造的ARP应答包之后会更新自己的ARP表，将目的地址的MAC地址更新为攻击者的MAC地址

3、DHCP欺骗的原理 + 防御过程
DHCP欺骗的原理：
1. 攻击者首先发起大量的DHCP请求，耗尽DHCP服务器的IP地址
2. 攻击者将自己的伪装成一个DHCP服务器
3. 为客服分配IP，自己的默认网关，这样外网的数据都到了攻击者这里

DHCP欺骗的防御手段：
1. 报文限速：对来自一个交换机或者一个MAC地址的报文进行限速
2. 限制用户的接入数，当用户数达到指定值的时候，任何用户都无法申请到ip
3. 对dhcp续租报文的合法性进行检查

## 第八讲

### 缓存区溢出

1、缓存区溢出的原因
用户输入的数据长度超出了程序为其分配的内存空间，这些数据就会覆盖程序为其它数据分配的内存空间，形成所谓的缓冲区溢出

2、


2、根据代码画出缓存区溢出的栈图


## Web安全漏洞

1、常见的的Web漏洞

CSRF，SQL注入，XSS等

2、如何防御SQL注入漏洞？

1. 对用户输入的信息进行检查和过滤（数据类型，是否是允许的字符集，是否满足格式要求）
2. 使用最小权限限制数据库用户的权限
3. 不使用拼接SQL语句
4. 使用存储过程来执行所有的查询
5. 将登录名和密码等数据加密保存

3、如何防御跨站脚本攻击漏洞？

1. 验证用户的数据，对输入的数据进行编码
2. 确定性类型字段加强校验规则（手机号，邮箱）
3. HTML模板做好转移
4. 设置httpOnly：禁止用户读取cookie

4、 输入验证在Web安全中的重要性

输入验证可以在一定程度上防止错误处理造成的各种漏洞，未经验证的输入可能会sql攻击、XSS攻击等









